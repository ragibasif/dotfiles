#!/usr/bin/env python3

import subprocess
from pathlib import Path

CWD = Path.cwd()

def get_dirs(wd):
    dirs = [wd]
    for dir in Path(wd).rglob('*'):
        if dir.is_dir() and not dir.name.startswith('.'):
            dirs.append(dir)
    return dirs

def pdf(dir):
    files = list(Path(dir).glob('*.pdf'))
    for file in files:
        path = file.resolve()
        exiftool_cmd = ["exiftool","-all=","-overwrite_original",f"{path}"]
        qpdf_cmd = ["qpdf","--linearize","--replace-input",f"{path}"]

        subprocess.run(exiftool_cmd)
        subprocess.run(qpdf_cmd)
        print(f"Cleaned metadata of {path}.")

def main():
    dirs = get_dirs(CWD)
    for dir in dirs:
        pdf(dir)


if __name__ == "__main__":
    main()
